<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Web AR - Muzium Penang</title>
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://rawgit.com/jeromeetienne/AR.js/1.7.2/aframe/build/aframe-ar.min.js"></script>
</head>
<body style="margin: 0; overflow: hidden;">
    <a-scene embedded arjs="sourceType: webcam; debugUIEnabled: false;" vr-mode-ui="enabled: false;">
        <!-- 3D Model (Draggable & Properly Positioned) -->
        <a-entity id="building" 
                  gltf-model="3D asset for Web AR/Muzium_Penang.glb" 
                  scale="5 5 5"
                  position="0 0 0"
                  gps-entity-place
                  gesture-handler>
        </a-entity>

        <!-- Location Text (Black for Visibility) -->
        <a-text id="locationText" 
                value="Loading location..." 
                position="0 2 -3" 
                color="black" 
                align="center"
                scale="2 2 2">
        </a-text>
    </a-scene>

    <script>
        // Get GPS location and update the text
        navigator.geolocation.getCurrentPosition(
            function(position) {
                let latitude = position.coords.latitude.toFixed(6);
                let longitude = position.coords.longitude.toFixed(6);
                document.getElementById("locationText").setAttribute("value", `Lat: ${latitude}, Lon: ${longitude}`);
            },
            function(error) {
                console.log("Error getting location", error);
                document.getElementById("locationText").setAttribute("value", "Location access denied.");
            },
            { enableHighAccuracy: true }
        );

        // Add gesture controls for dragging
        AFRAME.registerComponent('gesture-handler', {
            init: function () {
                let el = this.el;
                let dragging = false;
                let startPos = null;

                el.addEventListener('mousedown', function (event) {
                    dragging = true;
                    startPos = event.detail.intersection.point;
                });

                el.addEventListener('mouseup', function () {
                    dragging = false;
                });

                el.addEventListener('mousemove', function (event) {
                    if (!dragging) return;
                    let newPos = event.detail.intersection.point;
                    el.object3D.position.x += newPos.x - startPos.x;
                    el.object3D.position.z += newPos.z - startPos.z;
                    startPos = newPos;
                });
            }
        });
    </script>
</body>
</html>
